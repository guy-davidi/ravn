/* SPDX-License-Identifier: GPL-2.0 */
#ifndef __CORE_VULNERABILITY_H
#define __CORE_VULNERABILITY_H

#include "compat/linux/types.h"

/* Vulnerability event types */
enum vulnerability_event_type {
	VULN_VULNERABLE_SOFTWARE = 1,
	VULN_CONFIG_CHANGE = 2,
	VULN_PERMISSION_CHANGE = 3,
	VULN_NETWORK_SERVICE = 4,
	VULN_KERNEL_MODULE = 5,
	VULN_SYSCALL_VULNERABILITY = 6,
	VULN_MEMORY_VULNERABILITY = 7,
	VULN_FILE_VULNERABILITY = 8,
	VULN_NETWORK_VULNERABILITY = 9,
};

/* Vulnerability severity levels */
enum vulnerability_severity {
	VULN_SEVERITY_LOW = 1,
	VULN_SEVERITY_MEDIUM = 2,
	VULN_SEVERITY_HIGH = 3,
	VULN_SEVERITY_CRITICAL = 4,
};

/* Vulnerability event structure */
struct vulnerability_event {
	__u64 timestamp_ns;
	__u32 event_type;
	__u32 severity;
	__u32 pid;
	__u32 tgid;
	__u32 uid;
	__u32 gid;
	char comm[16];
	char process_path[256];
	
	/* Vulnerability specific data */
	char cve_id[32];
	char vulnerability_name[128];
	char affected_component[128];
	__u32 exploit_available;
	__u32 patch_available;
	__u32 risk_score;
	
	/* File information */
	char filename[256];
	__u32 file_inode;
	__u32 file_mode;
	__u64 file_size;
	
	/* Network information */
	__u32 src_ip;
	__u32 dst_ip;
	__u16 src_port;
	__u16 dst_port;
	__u8 protocol;
	
	/* Additional context */
	char command_line[512];
	__u32 parent_pid;
	__u32 session_id;
	__u32 confidence_score;
};

/* Vulnerable software detection */
struct vulnerable_software {
	__u32 pid;
	__u32 uid;
	char comm[16];
	char process_path[256];
	char software_name[128];
	char version[32];
	char cve_id[32];
	__u32 severity;
	__u32 exploit_available;
};

/* Configuration change detection */
struct config_change {
	__u64 timestamp_ns;
	__u32 pid;
	__u32 uid;
	char filename[256];
	__u32 file_inode;
	__u32 old_mode;
	__u32 new_mode;
	__u64 old_size;
	__u64 new_size;
	__u32 change_type; // 1=permission, 2=content, 3=ownership
	__u32 security_impact;
};

/* Permission change detection */
struct permission_change {
	__u64 timestamp_ns;
	__u32 pid;
	__u32 uid;
	char filename[256];
	__u32 file_inode;
	__u32 old_mode;
	__u32 new_mode;
	__u32 old_uid;
	__u32 new_uid;
	__u32 old_gid;
	__u32 new_gid;
	__u32 security_risk;
};

/* Network service vulnerability */
struct network_service_vuln {
	__u32 src_ip;
	__u32 dst_ip;
	__u16 port;
	__u8 protocol;
	char service_name[64];
	char version[32];
	char cve_id[32];
	__u32 severity;
	__u32 exploit_available;
	__u32 authentication_required;
};

/* Kernel module vulnerability */
struct kernel_module_vuln {
	__u32 pid;
	__u32 uid;
	char module_name[64];
	char version[32];
	char cve_id[32];
	__u32 severity;
	__u32 exploit_available;
	__u32 privilege_required;
};

/* Syscall vulnerability */
struct syscall_vuln {
	__u64 timestamp_ns;
	__u32 pid;
	__u32 uid;
	__u32 syscall_number;
	char comm[16];
	char cve_id[32];
	__u32 severity;
	__u32 exploit_available;
	__u32 privilege_required;
};

/* Memory vulnerability */
struct memory_vuln {
	__u64 timestamp_ns;
	__u32 pid;
	__u32 uid;
	char comm[16];
	__u32 vuln_type; // 1=buffer_overflow, 2=use_after_free, 3=double_free, 4=memory_leak
	__u32 target_address;
	__u32 size;
	__u32 severity;
	__u32 exploit_available;
};

#endif /* __CORE_VULNERABILITY_H */
